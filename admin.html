<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeuraVault | Admin Command Center</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

    <script src="js/data.js"></script>
    <script src="js/state.js"></script>
    <script>
        const user = State.getCurrentUser();
        if (!user || !user.isAdmin) {
            window.location.href = 'login.html';
        }
    </script>

    <style>
        /* --- GLOBAL RESET --- */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }

        :root {
            --bg-dark: #0f172a;
            --sidebar-bg: #020617;
            --admin-accent: #f43f5e;
            /* Rose Red */
            --text-white: #f8fafc;
            --text-grey: #94a3b8;
            --border-color: rgba(255, 255, 255, 0.05);
            --card-bg: #1e293b;
        }

        body {
            background-color: var(--bg-dark);
            color: var(--text-white);
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        input[type="date"]::-webkit-calendar-picker-indicator {
            filter: invert(1);
            cursor: pointer;
        }

        /* --- SIDEBAR --- */
        .sidebar {
            width: 260px;
            background: var(--sidebar-bg);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            padding: 1.5rem;
            flex-shrink: 0;
        }

        .logo {
            font-size: 1.4rem;
            font-weight: 800;
            color: white;
            margin-bottom: 3rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .logo span {
            color: var(--admin-accent);
        }

        .nav-label {
            font-size: 0.75rem;
            color: var(--text-grey);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 0.8rem;
            font-weight: 600;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 0.8rem 1rem;
            color: var(--text-grey);
            border-radius: 10px;
            cursor: pointer;
            transition: 0.2s;
            margin-bottom: 0.5rem;
        }

        .nav-item:hover,
        .nav-item.active {
            background: rgba(244, 63, 94, 0.1);
            color: white;
        }

        .nav-item.active {
            border-left: 3px solid var(--admin-accent);
        }

        /* --- MAIN CONTENT --- */
        .main-wrapper {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        header {
            height: 80px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 2rem;
            background: rgba(15, 23, 42, 0.9);
            backdrop-filter: blur(10px);
        }

        .admin-badge {
            background: var(--admin-accent);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            letter-spacing: 1px;
        }

        .content-area {
            flex: 1;
            overflow-y: auto;
            padding: 2rem;
            position: relative;
        }

        /* View Switching Logic */
        .view-section {
            display: none;
            animation: fadeIn 0.4s ease-out;
        }

        .view-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* --- VIEW 1: HOME (Dashboard) --- */
        .welcome-banner {
            margin-bottom: 2rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--card-bg);
            padding: 1.5rem;
            border-radius: 12px;
            border: 1px solid var(--border-color);
        }

        .stat-val {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-label {
            color: var(--text-grey);
            font-size: 0.9rem;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 1.5rem;
            height: 400px;
        }

        .dash-panel {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .panel-title {
            font-weight: 700;
            margin-bottom: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* Task List */
        .task-item {
            display: flex;
            gap: 10px;
            padding: 10px 0;
            border-bottom: 1px solid var(--border-color);
            font-size: 0.9rem;
            align-items: center;
        }

        .task-check {
            width: 18px;
            height: 18px;
            border: 2px solid var(--text-grey);
            border-radius: 4px;
            cursor: pointer;
        }

        .task-check.checked {
            background: var(--admin-accent);
            border-color: var(--admin-accent);
        }

        /* Calendar */
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            text-align: center;
            font-size: 0.8rem;
        }

        .cal-day {
            padding: 8px;
            border-radius: 4px;
            color: var(--text-grey);
        }

        .cal-day.today {
            background: var(--admin-accent);
            color: white;
            font-weight: bold;
        }

        .cal-day.event {
            border: 1px solid var(--admin-accent);
            color: var(--admin-accent);
        }

        /* Activity Log */
        .log-item {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            font-size: 0.85rem;
        }

        .log-time {
            color: var(--text-grey);
            min-width: 60px;
        }

        .log-text strong {
            color: white;
        }

        /* --- VIEW 2: UPLOAD --- */
        .upload-container {
            background: var(--card-bg);
            border-radius: 16px;
            border: 1px solid var(--border-color);
            padding: 2rem;
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 2rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-grey);
            font-size: 0.9rem;
        }

        .form-input,
        .form-select {
            width: 100%;
            background: #0f172a;
            border: 1px solid var(--border-color);
            padding: 0.8rem;
            border-radius: 8px;
            color: white;
            outline: none;
        }

        .drop-zone {
            border: 2px dashed var(--border-color);
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            color: var(--text-grey);
            height: 100%;
            cursor: pointer;
            transition: 0.3s;
        }

        .drop-zone:hover {
            border-color: var(--admin-accent);
            background: rgba(244, 63, 94, 0.05);
        }

        .btn-upload {
            background: var(--admin-accent);
            color: white;
            border: none;
            padding: 1rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            margin-top: 1rem;
        }

        /* --- VIEW 3: ANALYTICS --- */
        .analytics-row {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .chart-box {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 2rem;
            height: 300px;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            position: relative;
        }

        /* CSS Bar Chart Simulation */
        .bar-chart {
            display: flex;
            justify-content: space-around;
            align-items: flex-end;
            height: 100%;
            width: 100%;
            gap: 20px;
        }

        .bar {
            width: 40px;
            background: rgba(244, 63, 94, 0.5);
            border-radius: 4px 4px 0 0;
            position: relative;
            transition: height 1s ease;
        }

        .bar::after {
            content: attr(data-label);
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            color: var(--text-grey);
            font-size: 0.8rem;
        }

        .bar:hover {
            background: var(--admin-accent);
        }

        .retention-graph {
            width: 100%;
            height: 100%;
            position: relative;
            border-left: 1px solid var(--text-grey);
            border-bottom: 1px solid var(--text-grey);
        }

        .line-path {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to right, transparent, rgba(244, 63, 94, 0.1));
            clip-path: polygon(0 80%, 20% 60%, 40% 70%, 60% 40%, 80% 50%, 100% 20%, 100% 100%, 0 100%);
        }

        /* --- VIEW 4: BROADCAST --- */
        .broadcast-box {
            max-width: 600px;
            margin: 0 auto;
            background: var(--card-bg);
            padding: 2rem;
            border-radius: 12px;
            border: 1px solid var(--border-color);
        }

        .broadcast-preview {
            margin-top: 2rem;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-left: 3px solid var(--admin-accent);
            border-radius: 4px;
        }

        /* --- VIEW 5: MANAGE BATCHES --- */
        .batch-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }

        .batch-card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            transition: transform 0.2s, border-color 0.2s;
        }

        .batch-card:hover {
            transform: translateY(-2px);
            border-color: var(--admin-accent);
        }

        .batch-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .batch-header h3 {
            font-size: 1.1rem;
            color: white;
            margin: 0;
        }

        .admin-badge {
            font-size: 0.75rem;
            padding: 4px 8px;
            border-radius: 4px;
            color: #1e293b;
            font-weight: 700;
        }

        .export-btn {
            background: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-grey);
            padding: 10px;
            border-radius: 6px;
            cursor: pointer;
            width: 100%;
            margin-top: auto;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .export-btn:hover {
            background: rgba(255, 255, 255, 0.05);
            color: white;
            border-color: white;
        }



        .batch-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .export-btn {
            background: transparent;
            border: 1px solid var(--admin-accent);
            color: var(--admin-accent);
            padding: 5px 10px;
            border-radius: 6px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: 0.2s;
        }

        .export-btn:hover {
            background: var(--admin-accent);
            color: white;
        }

        /* --- MODAL --- */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            z-index: 100;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .modal {
            background: #1e293b;
            padding: 2rem;
            border-radius: 16px;
            text-align: center;
            border: 1px solid var(--admin-accent);
            box-shadow: 0 0 30px rgba(244, 63, 94, 0.2);
        }
    </style>
</head>

<body>

    <div class="sidebar">
        <div class="logo">üîí Neura<span>Vault</span> <span
                style="font-size:0.6rem; background:var(--admin-accent); color:white; padding:2px 6px; border-radius:4px; margin-left:5px;">ADMIN</span>
        </div>

        <div class="nav-label">Management</div>
        <div class="nav-item active" id="nav-home" onclick="switchView('home')"><span>üìä</span> Home</div>
        <div class="nav-item" id="nav-upload" onclick="switchView('upload')"><span>üì§</span> Upload Content</div>
        <div class="nav-item" id="nav-analytics" onclick="switchView('analytics')"><span>üìà</span> Analytics</div>
        <div class="nav-item" id="nav-broadcast" onclick="switchView('broadcast')"><span>üì¢</span> Broadcast</div>
        <div class="nav-item" id="nav-batches" onclick="switchView('batches')"><span>üë•</span> Manage Batches</div>

        <div class="nav-label" style="margin-top: 2rem;">System</div>
        <div class="nav-item" id="nav-settings" onclick="switchView('settings')"><span>‚öôÔ∏è</span> Settings</div>
        <div class="nav-item" onclick="logoutAdmin()" style="color:#ef4444; margin-top: auto;"><span>üö™</span> Logout
        </div>
    </div>

    <div class="main-wrapper">
        <header>
            <h3>Admin Command Center</h3>
            <div style="display: flex; align-items: center; gap: 15px;">
                <span class="admin-badge">SUPER ADMIN</span>
                <div style="width: 40px; height: 40px; background: #334155; border-radius: 50%;"></div>
            </div>
        </header>

        <div class="content-area">

            <section id="view-home" class="view-section active">
                <div class="welcome-banner">
                    <h1 style="font-size: 2rem;">Welcome Back, Admin üëã</h1>
                    <p style="color: var(--text-grey);">Here's what's happening in your vault today.</p>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-val" id="stat-revenue">$14.2k</div>
                        <div class="stat-label">Monthly Revenue</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-val" id="stat-students">0</div>
                        <div class="stat-label">Total Students</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-val" id="stat-batches">0</div>
                        <div class="stat-label">Active Batches</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-val">420GB</div>
                        <div class="stat-label">Vault Storage</div>
                    </div>
                </div>




                <div class="dashboard-grid">
                    <div class="dash-panel">
                        <div class="panel-title">
                            Pending Tasks <span>üìù</span>
                        </div>
                        <div style="display: flex; flex-direction: column; gap: 8px; margin-bottom: 15px;">
                            <input type="text" id="newTaskTitle" placeholder="New Task..."
                                style="width: 100%; background: #0f172a; border: 1px solid var(--border-color); padding: 8px; border-radius: 6px; color: white; font-size: 0.85rem;">
                            <div style="display: flex; gap: 8px;">
                                <input type="date" id="newTaskDate"
                                    style="flex: 1; background: #0f172a; border: 1px solid var(--border-color); padding: 8px; border-radius: 6px; color: white; font-size: 0.85rem;">
                                <button onclick="addNewTask()"
                                    style="background: var(--admin-accent); border: none; color: white; padding: 8px 12px; border-radius: 6px; cursor: pointer; font-weight: bold;">Add</button>
                            </div>
                        </div>
                        <div id="todo-list" style="overflow-y:auto; max-height: 300px;">
                            <!-- Dynamic Tasks -->
                        </div>
                    </div>

                    <div class="dash-panel">
                        <div class="panel-title">Deadlines <span>üìÖ</span></div>
                        <div class="calendar-grid" id="admin-calendar">
                            <!-- Dynamic Calendar -->
                        </div>
                        <div style="margin-top: 1rem; font-size: 0.85rem; color: var(--text-grey);">
                            <div style="margin-bottom:5px;"><span style="color:var(--admin-accent)">‚óè</span> Today: Feb
                                11</div>
                            <div><span style="color:var(--admin-accent)">‚óã</span> Tasks: Synchronized</div>
                        </div>
                    </div>

                    <div class="dash-panel">
                        <div class="panel-title">Recent Updates <span>‚ö°</span></div>
                        <div class="log-item">
                            <div class="log-time">10:42</div>
                            <div class="log-text"><strong>System</strong> auto-backed up database.</div>
                        </div>
                        <div class="log-item">
                            <div class="log-time">09:15</div>
                            <div class="log-text"><strong>Admin</strong> uploaded "Quantum Mechanics".</div>
                        </div>
                        <div class="log-item">
                            <div class="log-time">Yesterday</div>
                            <div class="log-text"><strong>User 842</strong> upgraded to Elite.</div>
                        </div>
                        <div class="log-item">
                            <div class="log-time">Yesterday</div>
                            <div class="log-text"><strong>Alert:</strong> High traffic detected.</div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="view-upload" class="view-section">
                <div class="upload-container">
                    <div class="form-side">
                        <h2 style="margin-bottom: 1.5rem;">Upload to Vault</h2>
                        <div class="form-group">
                            <label class="form-label">Select Subject</label>
                            <div style="display: flex; gap: 10px;">
                                <select class="form-select" id="uploadCourseSelect" style="flex: 1;">
                                    <!-- Populated via JS -->
                                </select>
                                <button onclick="addNewSubject()" title="Add New Subject"
                                    style="background: var(--card-bg); border: 1px solid var(--admin-accent); color: var(--admin-accent); padding: 0 10px; border-radius: 6px; cursor: pointer; font-weight: bold;">+</button>
                                <button onclick="deleteSubject()" title="Delete Selected Subject"
                                    style="background: var(--card-bg); border: 1px solid #ef4444; color: #ef4444; padding: 0 10px; border-radius: 6px; cursor: pointer; font-weight: bold;">üóë</button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Lesson Title</label>
                            <input type="text" class="form-input" id="uploadLessonTitle"
                                placeholder="Enter lesson title (e.g. Thermodynamics)">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Content Source (Video or PDF)</label>
                            <input type="text" class="form-input" id="uploadVideoUrl"
                                placeholder="e.g. assets/notes.pdf, .mp4, or YouTube URL">
                        </div>
                        <button class="btn-upload" onclick="simulateUpload()">Start Upload</button>
                    </div>
                    <div class="drop-side">
                        <div class="drop-zone" id="dropZone">
                            <div style="font-size: 3rem; margin-bottom: 1rem;">‚òÅÔ∏è</div>
                            <p>Drag files here</p>
                            <input type="file" id="fileInput" style="display: none;" onchange="handleFileSelect(this)">
                            <button onclick="document.getElementById('fileInput').click()"
                                style="margin-top:10px; background:none; border:1px solid var(--text-grey); color:var(--text-grey); padding:5px 10px; border-radius:4px; cursor:pointer;">Browse</button>
                        </div>
                    </div>
                </div>
            </section>

            <section id="view-analytics" class="view-section">
                <h2>Platform Analytics</h2>
                <div class="analytics-row">
                    <div class="chart-box">
                        <div class="panel-title">Trending Batches (Enrollments)</div>
                        <div class="bar-chart">
                            <div class="bar" style="height: 40%;" data-label="Bio"></div>
                            <div class="bar" style="height: 80%; background: var(--admin-accent);" data-label="Phys">
                            </div>
                            <div class="bar" style="height: 60%;" data-label="Chem"></div>
                            <div class="bar" style="height: 50%;" data-label="Math"></div>
                            <div class="bar" style="height: 30%;" data-label="CS"></div>
                        </div>
                    </div>
                    <div class="chart-box">
                        <div class="panel-title">Avg Viewer Retention</div>
                        <div class="retention-graph">
                            <div class="line-path"></div>
                            <div
                                style="position: absolute; top: 20px; left: 20px; font-size: 2rem; font-weight: bold; color: var(--admin-accent);">
                                68%</div>
                            <div style="position: absolute; bottom: 10px; right: 10px; color: var(--text-grey);">Last 7
                                Days</div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="view-broadcast" class="view-section">
                <div class="broadcast-box">
                    <h2 style="margin-bottom: 1.5rem;">Send Announcement</h2>
                    <div class="form-group">
                        <label class="form-label">Target Audience</label>
                        <select class="form-select">
                            <option>All Students</option>
                            <option>Physics Batch Only</option>
                            <option>Elite Members Only</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Message Title</label>
                        <input type="text" class="form-input" placeholder="e.g. Live Class Rescheduled">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Body</label>
                        <textarea class="form-input" rows="5" placeholder="Type your message..."></textarea>
                    </div>
                    <button class="btn-upload" onclick="alert('Announcement Sent Successfully!')">Broadcast
                        Message</button>
                </div>
            </section>

            <section id="view-batches" class="view-section">
                <h2 style="margin-bottom: 1.5rem;">Active Batches</h2>
                <div class="batch-grid" id="admin-batch-list">
                    <!-- Dynamic Content -->
                </div>
            </section>

            <section id="view-settings" class="view-section">
                <h2>Admin Settings</h2>
                <div style="max-width: 500px; margin-top: 1rem;">
                    <div class="form-group">
                        <label class="form-label">System Name</label>
                        <input type="text" class="form-input" value="NeuraVault Admin">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Admin Email</label>
                        <input type="email" class="form-input" value="superadmin@neuramach.ai" disabled>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Notification Preference</label>
                        <select class="form-select">
                            <option>Email & Push</option>
                            <option>Email Only</option>
                        </select>
                    </div>
                    <button class="btn-upload">Save Changes</button>
                </div>
            </section>

        </div>
    </div>

    <div class="modal-overlay" id="successModal">
        <div class="modal">
            <div style="font-size: 3rem; margin-bottom: 1rem;">‚úÖ</div>
            <h2>Success</h2>
            <p id="successText" style="color: var(--text-grey); margin-bottom: 1.5rem;">Operation completed.</p>
            <button class="btn-upload"
                onclick="document.getElementById('successModal').style.display='none'">Close</button>
        </div>
    </div>

    <script>
        // INIT STATS
        document.getElementById('stat-students').innerText = mockUsers.length - 1; // Exclude admin
        document.getElementById('stat-batches').innerText = mockCourses.length;

        // --- TASKS & CALENDAR SYNC ---
        function renderTasksAndCalendar() {
            const tasks = State.getTasks();
            const todoList = document.getElementById('todo-list');
            const calendar = document.getElementById('admin-calendar');

            // 1. Render To-Do List
            todoList.innerHTML = tasks.map(t => `
                <div class="task-item">
                    <div class="task-check ${t.completed ? 'checked' : ''}" onclick="toggleTask('${t.id}')"></div>
                    <span style="${t.completed ? 'text-decoration: line-through; opacity: 0.5;' : ''}">${t.title}</span>
                    <div style="margin-left:auto; display:flex; align-items:center; gap:10px;">
                        <span style="font-size:0.7rem; color:var(--text-grey);">${t.date.slice(5)}</span>
                        <button onclick="removeTask('${t.id}')" style="background:none; border:none; cursor:pointer; color:#ef4444; font-size:0.9rem;" title="Delete Task">üóë</button>
                    </div>
                </div>
            `).join('');

            // 2. Render Calendar (Simple Feb 2026 View)
            // Header
            let calHtml = `<span>M</span><span>T</span><span>W</span><span>T</span><span>F</span><span>S</span><span>S</span>`;

            // Days (Feb 1st 2026 starts on Sunday (idx 6), but let's just do a simple fill for prototype)
            // Let's assume a generic 30 day grid starting Monday for simplicity or match the previous hardcoded one
            // Previous: 1-14 shown. Let's show full month 1-28.

            for (let i = 1; i <= 28; i++) {
                const dayStr = i < 10 ? `0${i}` : `${i}`;
                const dateStr = `2026-02-${dayStr}`;

                // Find tasks for this day
                const dayTasks = tasks.filter(t => t.date === dateStr);
                const hasEvent = dayTasks.length > 0;
                const isToday = i === 11; // Hardcoded "Today" from original mock

                let classes = 'cal-day';
                if (isToday) classes += ' today';
                if (hasEvent) classes += ' event';

                // Tooltip logic could go here
                calHtml += `<span class="${classes}" title="${dayTasks.map(t => t.title).join(', ')}">${i}</span>`;
            }
            calendar.innerHTML = calHtml;
        }

        function toggleTask(id) {
            State.toggleTask(id);
            renderTasksAndCalendar(); // Re-render both to show updates
        }

        function removeTask(id) {
            if (confirm("Are you sure you want to delete this task?")) {
                State.deleteTask(id);
                renderTasksAndCalendar();
            }
        }

        function addNewTask() {
            const titleInput = document.getElementById('newTaskTitle');
            const dateInput = document.getElementById('newTaskDate');
            const title = titleInput.value.trim();
            const date = dateInput.value;

            if (title && date) {
                State.addTask(title, date);
                titleInput.value = '';
                dateInput.value = '';
                renderTasksAndCalendar();
            } else {
                alert("Please enter both a task title and a date.");
            }
        }

        // --- UPLOAD LOGIC ---
        const uploadCourseSelect = document.getElementById('uploadCourseSelect');
        // Lesson select removed, now using input

        function renderUploadOptions() {
            const courses = State.getCourses();
            if (!uploadCourseSelect) return;

            const currentVal = uploadCourseSelect.value;
            uploadCourseSelect.innerHTML = courses.map(c => `<option value="${c.id}">${c.title}</option>`).join('');
            if (currentVal) uploadCourseSelect.value = currentVal;
        }

        function addNewSubject() {
            const title = prompt("Enter new subject name:");
            if (title) {
                const newCourse = State.addCourse(title);
                renderUploadOptions();
                uploadCourseSelect.value = newCourse.id; // Auto-select
            }
        }

        function deleteSubject() {
            const courseId = uploadCourseSelect.value;
            if (!courseId) return;

            if (confirm("Are you sure you want to delete this subject and all its lessons?")) {
                State.deleteCourse(courseId);
                renderUploadOptions();
                // Update stats
                document.getElementById('stat-batches').innerText = State.getCourses().length;
            }
        }

        // DRAG & DROP LOGIC
        const dropZone = document.getElementById('dropZone');
        const videoInput = document.getElementById('uploadVideoUrl');

        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        ['dragenter', 'dragover'].forEach(eventName => {
            dropZone.addEventListener(eventName, highlight, false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, unhighlight, false);
        });

        function highlight(e) {
            dropZone.style.borderColor = 'var(--admin-accent)';
            dropZone.style.background = 'rgba(255,255,255,0.05)';
        }

        function unhighlight(e) {
            dropZone.style.borderColor = 'var(--border-color)';
            dropZone.style.background = ''; // Reset
        }

        dropZone.addEventListener('drop', handleDrop, false);

        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            handleFiles(files);
        }

        function handleFileSelect(input) {
            handleFiles(input.files);
        }

        function handleFiles(files) {
            if (files.length > 0) {
                const file = files[0];
                // Simulate a path. In browser we can't get real full path.
                // We'll use a fake path or just the name for our prototype logic
                // If the user drags a real file, we can't play it easily without FileReader or URL.createObjectURL
                // For this prototype, we'll try to create a blob URL if possible to make it ACTUALLY work locally!

                const objectURL = URL.createObjectURL(file);
                videoInput.value = objectURL; // This makes it playable!

                // Visual feedback
                const p = dropZone.querySelector('p');
                p.innerText = `Selected: ${file.name}`;
                p.style.color = '#10b981';
            }
        }

        // --- BATCH DETAILS & BROADCAST ---
        let currentBatchId = null;

        function openBatchDetails(courseId) {
            currentBatchId = courseId;
            const course = State.getCourses().find(c => c.id === courseId);
            if (!course) return;

            document.getElementById('detailBatchTitle').innerText = course.title;

            // Render Content List
            const contentList = document.getElementById('detailContentList');
            if (course.lessons && course.lessons.length > 0) {
                contentList.innerHTML = course.lessons.map(l => `
                    <div style="padding: 10px; background: rgba(255,255,255,0.05); margin-bottom: 5px; border-radius: 6px; display: flex; justify-content: space-between;">
                        <span>${l.title}</span>
                        <span style="font-size: 0.8rem; color: var(--text-grey);">${l.videoUrl ? (l.videoUrl.endsWith('.pdf') ? 'üìÑ PDF' : 'üé• Video') : 'Pending'}</span>
                    </div>
                `).join('');
            } else {
                contentList.innerHTML = '<p style="color: var(--text-grey);">No content uploaded yet.</p>';
            }

            // RENDER BROADCAST HISTORY
            const historyContainer = document.getElementById('broadcastHistoryList');
            if (course.announcements && course.announcements.length > 0) {
                historyContainer.innerHTML = course.announcements.map(a => `
                    <div style="background: rgba(255,255,255,0.05); padding: 10px; border-radius: 6px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: flex-start;">
                        <div>
                            <div style="font-size: 0.75rem; color: #94a3b8; margin-bottom: 4px;">${a.date}</div>
                            <div style="color: #e2e8f0; font-size: 0.9rem;">${a.text}</div>
                        </div>
                        <button onclick="deleteBatchBroadcast(${a.timestamp})" style="background: none; border: none; cursor: pointer; color: #ef4444; font-size: 1.2rem; margin-left: 10px;">üóë</button>
                    </div>
                `).join('');
            } else {
                historyContainer.innerHTML = `<p style="color: var(--text-grey); font-style: italic; font-size: 0.9rem;">No broadcasts sent yet.</p>`;
            }

            document.getElementById('batchDetailModal').style.display = 'flex';
        }

        function deleteBatchBroadcast(timestamp) {
            if (confirm("Are you sure you want to delete this broadcast? It will be removed from all student dashboards.")) {
                State.deleteAnnouncement(currentBatchId, timestamp);
                // Refresh the modal to show updated list
                openBatchDetails(currentBatchId);
            }
        }

        function closeBatchDetail() {
            document.getElementById('batchDetailModal').style.display = 'none';
        }

        function sendBatchBroadcast() {
            const msg = document.getElementById('broadcastMsg').value;
            if (!msg) return alert("Please enter a message!");

            State.addAnnouncement(currentBatchId, msg);

            alert("Broadcast sent successfully to all enrolled students!");
            document.getElementById('broadcastMsg').value = '';

            // Re-render to show new message in history
            openBatchDetails(currentBatchId);
        }

        // Expose simulateUpload globally
        window.simulateUpload = function () {
            const courseId = uploadCourseSelect.value;
            const lessonTitle = document.getElementById('uploadLessonTitle').value;
            const videoUrl = document.getElementById('uploadVideoUrl').value;

            if (!videoUrl || !lessonTitle) {
                alert("Please enter a lesson title and video URL/Path.");
                return;
            }

            const btn = document.querySelector('.btn-upload');
            const originalText = btn.innerHTML;
            btn.innerHTML = 'Uploading... ‚è≥';
            btn.disabled = true;

            setTimeout(() => {
                State.addOrUpdateLesson(courseId, lessonTitle, videoUrl);
                btn.innerHTML = 'Upload Complete ‚úÖ';
                btn.style.background = '#10b981';

                setTimeout(() => {
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                    btn.style.background = ''; // Revert to CSS
                    document.getElementById('uploadVideoUrl').value = '';
                    document.getElementById('uploadLessonTitle').value = '';
                    alert(`Lesson "${lessonTitle}" added/updated successfully!\n\nCheck the Student Dashboard.`);
                }, 2000);
            }, 1500);
        };

        // Initial render
        renderUploadOptions();


        // Initial Render
        renderTasksAndCalendar();

        // RENDER ADMIN BATCHES
        function renderAdminBatches() {
            const courses = State.getCourses();
            const batchContainer = document.getElementById('admin-batch-list');

            batchContainer.innerHTML = courses.map(c => {
                const studentCount = State.getStudentCount(c.id);
                return `
                <div class="batch-card">
                    <div class="batch-header">
                        <h3>${c.title}</h3>
                        <span class="admin-badge" style="background:#10b981;">Active</span>
                    </div>
                    <div style="margin-bottom: 1rem;">
                        <p style="color: var(--text-grey); font-size: 0.9rem;">${c.rating} ‚òÖ ‚Ä¢ ${c.lessonsCount} Lessons</p>
                        <p style="color: var(--text-white); font-weight: 500; margin-top: 5px;">üë• ${studentCount} Students Enrolled</p>
                    </div>
                    <div style="display:flex; gap:10px;">
                        <button class="export-btn" onclick="openBatchDetails('${c.id}')">Manage & Broadcast</button>
                    </div>
                </div>`;
            }).join('');
        }
        renderAdminBatches(); // Initial Call


        // NAVIGATION LOGIC
        function switchView(viewName) {
            document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
            document.getElementById('view-' + viewName).classList.add('active');

            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            document.getElementById('nav-' + viewName).classList.add('active');
        }

        function logoutAdmin() {
            State.logout();
        }



        // EXPORT SIMULATION
        function exportData(batchName) {
            document.getElementById('successText').innerText = `Exporting data for ${batchName}... Download starting.`;
            document.getElementById('successModal').style.display = 'flex';
        }
    </script>

    <!-- BATCH DETAIL MODAL (Global) -->
    <div class="modal-overlay" id="batchDetailModal"
        style="display: none; align-items: center; justify-content: center; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000;">
        <div class="modal-content"
            style="background: var(--card-bg); width: 600px; max-width: 90%; border-radius: 12px; padding: 2rem; border: 1px solid var(--border-color);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                <h2 id="detailBatchTitle" style="color:white;">Course Details</h2>
                <button onclick="closeBatchDetail()"
                    style="background:none; border:none; color:white; font-size: 1.5rem; cursor: pointer;">‚úï</button>
            </div>

            <div style="margin-bottom: 2rem;">
                <h3
                    style="font-size: 1rem; color: var(--text-grey); margin-bottom: 10px; text-transform: uppercase; letter-spacing: 1px;">
                    Uploaded Content</h3>
                <div id="detailContentList" style="max-height: 200px; overflow-y: auto;">
                    <!-- Dynamic Content -->
                </div>
            </div>

            <div style="border-top: 1px solid var(--border-color); padding-top: 1.5rem;">
                <h3 style="font-size: 1rem; color: var(--admin-accent); margin-bottom: 10px;">üì¢ Broadcast to
                    Students</h3>
                <textarea id="broadcastMsg" rows="3" placeholder="Write an announcement for this batch..."
                    style="width: 100%; background: #0f172a; border: 1px solid var(--border-color); color: white; padding: 10px; border-radius: 6px; margin-bottom: 10px;"></textarea>
                <button onclick="sendBatchBroadcast()"
                    style="background: var(--admin-accent); color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: bold; width: 100%;">Send
                    Broadcast</button>
            </div>

            <div style="margin-top: 2rem; border-top: 1px solid var(--border-color); padding-top: 1rem;">
                <h3 style="font-size: 0.9rem; color: var(--text-grey); margin-bottom: 10px;">RECENT BROADCASTS</h3>
                <div id="broadcastHistoryList" style="max-height: 150px; overflow-y: auto;">
                    <!-- History Rendered Here -->
                </div>
            </div>
        </div>
    </div>

</body>

</html>